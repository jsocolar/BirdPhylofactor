{
    "collab_server" : "",
    "contents" : "library(phylofactor)\nlibrary(ggplot)\nlibrary(ggpubr)\n\nload('workspaces/CR_LUI_mStable_phylofactorization_workspace')\n\n\n\n\n# Summary -----------------------------------------------------------------\n\npf\n### the following function will be useful for visualizing results from each factor\n\npf.boxplot <- function(n,pf.=pf){\n  pf$models[[n]]$data %>%\n      ggplot(aes(LUI,Successes,color=phylo))+\n      geom_boxplot()+\n      geom_jitter(size=3,width = .2)+\n      facet_grid(.~phylo)+\n      ggtitle(paste('Factor',n))\n}\n\n### an easy way to peruse phylofactor objects\nn=7\ns <- summary(pf,taxonomy,n)                                     ### shortest-unique-taxonomic-prefix grouping & signal calculation for relative importance\ns.species <- summary(pf,taxonomy,n,taxon.trimming='species')  ### provides species-specific signal calculation\n\ns$taxa.split$group1 ##group1 is the descendant and often monophyletic group, R, in the data below:\ns.species\n#### The species-level summary re-computes the objective function for each species, contrasting it\n#### with the entirety of the opposing group as a measure of \"signal\" for each species. Thus, if we call\n#### Empidonax_flaviventris R, all of Group2 S, and all the rest of species NA, we get \n#### a deviance of 742.0165 from the phylo:LUI terms. Only the top-three species for each level are displayed\n#### when printing the summary object, but the full information can be obtained in the signal.table element.\ns.species$signal.table$Group1[1:10,]\ns.species$signal.table$Group2[1:10,]\n\n#### One can usually expect clades at the uppper & lower bounds of these signal tables to be\n#### partitioned in later factors.\n# For example, factors 8-10 further partition the paraphyletic Group2\n# and factors 17 and 18 further partition the suboscine group in 7\n\n\npf$tree$tip.label[sapply(pf$groups[8:10],'[[',1)] \n#factors 8=10: Turdus grayi, Hylophilus_decurtatus, Henicorhina_leucosticta, top members of the Group2 signal.table\n\nsummary(pf,taxonomy,17)  # Synallaxis_brachyura\npf.boxplot(17)\nsummary(pf,taxonomy,18)\npf.boxplot(18)           #A group of TitTyranRest, led by Ornithion_brunneicapillus, don't have as dramatic of a decrease from forest-diversified\n\n\n\n\n# Number of sign factors --------------------------------------------------\n\n### Quick check: What is an approximate number of significant factors?\n### To be conservative, we'll use a strict, bonferroni cutoff of \n### multiple comparisons, where the number of comparisons is the number of\n### edges in the tree\nn_edge <- Nedge(tree)\n\nmodel_deviance <- numeric(pf$nfactors)\nfor (i in 1:pf$nfactors){\n  model_deviance[i] <- pvDeviance(pf$models[[i]],pf$groups[[i]],pf$tree,\n                                  PartitioningVariables = 'LUI',model.fcn = glm,pf$models[[i]]$data)\n}\npvals <- 1-pchisq(model_deviance,df=2)\ncutoff <- 0.05/n_edge   \nmin(which(pvals>cutoff)) \n#all of these factors are well below the cutoff.\n\n\n\n\n\n\n\n\n\n\n\n\n# More Visualization -----------------------------------------------------------\n\ntree_plot <-  pf.tree(pf,factors = 1:7)\ntree_plot$ggplot\n\n### Demo: how to plot data for a factor that matches colors in the tree_plot\nn=7\nbox_plot <- pf$models[[n]]$data[pf$models[[n]]$data$phylo=='R'] %>%\n  ggplot(aes(LUI,Successes))+\n  geom_boxplot()+\n  geom_jitter(color=tree_plot$legend$colors[n],size=3,width = .2)+\n  ggtitle(paste('Factor',n))\n\nggarrange(tree_plot$ggplot,box_plot,ncol=2)\n\n### for ease, we'll make a function that box-plots a particular factor\n### given a pf.tree object\npp <- pf.tree(pf,factors = 1:10)\nbplot <- function(i){\n  if (i<=nrow(pp$legend)){  ## the paraphyletic remainder is stored in the last row\n    grp <- pf$groups[[i]][[1]]\n    col <- pp$legend$colors[i]\n  } else {\n    grp <- pf$groups[[i]][[2]]\n    col <- NULL\n  }\n  y <- colSums(Successes[grp,,drop=F])\n  plot(X$LUI,y,xlab=NULL,ylab=NULL,lwd=2,cex.axis=2,col=col,cex.main=1.5,main=paste('Factor',i))\n}\n\n\ntiff('Figures/All_Birds_Counts.tiff',height=400,width=800)\n  par(mfrow=c(1,1))\n  y <- colSums(Successes)    #ag\n  plot(X$LUI,y,xlab=NULL,ylab=NULL,lwd=2,main=\"All Birds\",col='grey',cex.axis=2,cex.main=2)\ndev.off()\n\ntiff('Figures/Bird_Factor_Counts.tiff',height=1400,width=800)\n  par(mfrow=c(3,2))\n  for (i in 1:6){\n    bplot(i)\n  }\ndev.off()\n\n",
    "created" : 1528563066119.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3912758322",
    "id" : "BEA3C131",
    "lastKnownWriteTime" : 1528640974,
    "last_content_update" : 1528640974834,
    "path" : "~/Socolar/BirdPhylofactor/scripts/(2)analysis_and_viz_phylofactorization_object.R",
    "project_path" : "scripts/(2)analysis_and_viz_phylofactorization_object.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}